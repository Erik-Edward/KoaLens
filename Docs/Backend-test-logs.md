info: Processing request from /api/ai/analyze-image {"hasImage":true,"preferredLanguage":"sv","service":"koalens-backend","timestamp":"2025-03-27T20:58:58.650Z"}
info: GeminiService initialized {"maxOutputTokens":2048,"modelName":"gemini-2.5-pro-exp-03-25","service":"koalens-backend","timestamp":"2025-03-27T20:58:58.739Z"}
info: Initialized Gemini service {"service":"koalens-backend","timestamp":"2025-03-27T20:58:58.740Z"}
info: Analyzing image with Gemini {"imageHashSuffix":"b71a5022","preferredLanguage":"sv","service":"koalens-backend","template":"imageAnalysis_sv","timestamp":"2025-03-27T20:58:58.966Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":2048,"temperature":0.4,"topK":40,"topP":0.8},"mediaSizeBytes":437475,"mediaType":"image/jpeg","prompt":"\nDu är en bildanalysexpert specialiserad på att analysera matförpackningar för veganska konsumenter.\n\nAnalysera denna produktförpackning och extrahera ingredienslistan. Fokusera särskilt på att identifiera icke-veganska ingredienser.\n\nSteg-för-steg analys:\n1. Identifiera produktnamn och typ om möjligt\n2. Lokalisera ingredienslistan (ofta markerad med \"Ingredienser:\" eller liknande)\n3. Lista alla ingredienser som tydligt kan identifieras\n4. Undersök noggrant om någon av dessa ingredienser är icke-veganska\n5. Bedöm om produkten är vegansk, icke-vegansk, eller om det är oklart\n\nReferens för vanliga icke-veganska ingredienser:\n- Mjölk, grädde, vassle, laktos, mjölkpulver, kasein\n- Ägg, äggula, äggvita, äggalbumin\n- Honung, bivax, propolis\n- Gelatin, kollagen\n- Karmin/E120 (från insekter)\n- Lanolin (från ullfett)\n- Löpe (från kalvmagar)\n- Shellac/E904 (från insekter)\n\nRapportera alla bildkvalitetsproblem som gör analysen svår.\n\nSvara i följande JSON-format:\n{\n  \"isVegan\": boolean eller null om osäker,\n  \"confidence\": nummer mellan 0 och 1,\n  \"ingredientList\": [lista över alla identifierade ingredienser],\n  \"nonVeganIngredients\": [lista över identifierade icke-veganska ingredienser],\n  \"reasoning\": \"förklaring av ditt resonemang\",\n  \"imageQualityIssues\": [\"BLUR\", \"INCOMPLETE\", \"LOW_CONTRAST\", ...] eller []\n}\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-03-27T20:58:58.967Z"}
info: AI Response [gemini] {"completionTokens":146.5,"mediaTokens":"Multimodal content","promptTokens":331,"provider":"gemini","responseText":"```json\n{\n  \"isVegan\": true,\n  \"confidence\": 1,\n  \"ingredientList\": [\n    \"Majskorn* 86%\",\n    \"palm...","service":"koalens-backend","timestamp":"2025-03-27T20:59:08.811Z"}
info: Parsed analysis result {"confidence":1,"ingredientCount":3,"isVegan":true,"nonVeganCount":0,"service":"koalens-backend","timestamp":"2025-03-27T20:59:08.814Z"}
warn: Image analysis performance slow {"service":"koalens-backend","timeMs":10164,"timestamp":"2025-03-27T20:59:08.815Z"}