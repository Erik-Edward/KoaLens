info: Video analysis request received {"dataSize":13856976,"mimeType":"video/quicktime","preferredLanguage":"sv","service":"koalens-backend","timestamp":"2025-03-29T11:40:06.104Z"}
info: Starting video analysis {"mimeType":"video/quicktime","preferredLanguage":"sv","service":"koalens-backend","timestamp":"2025-03-29T11:40:06.109Z"}

info: Video optimization completed {"compressionRatio":"2.71","optimizedSizeMB":"3.65","originalSizeMB":"9.91","service":"koalens-backend","timestamp":"2025-03-29T11:40:11.652Z"}
info: Sending video for AI analysis {"promptLength":762,"service":"koalens-backend","timestamp":"2025-03-29T11:40:11.660Z","videoSizeKB":3741}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":3072,"temperature":0.4,"topK":40,"topP":0.8},"mediaSizeBytes":3830307,"mediaType":"video/mp4","prompt":"Du är en expert på att analysera matvaror och ingredienser från video. Din uppgift är att analysera videon och identifiera alla ingredienser som visas.\n\nAnalysera den tillhandahållna videon och identifiera alla ingredienser som visas. Svara med en JSON-struktur i följande format:\n\n```json\n{\n  \"ingredients\": [\n    {\n      \"name\": \"ingrediensnamn\",\n      \"isVegan\": boolean,\n      \"confidence\": number mellan 0 och 1\n    }\n  ],\n  \"isVegan\": boolean,\n  \"confidence\": number mellan 0 och 1\n}\n```\n\nVar extra uppmärksam på:\n1. Alla synliga ingredienser\n2. Förpackningar och etiketter som visas\n3. Om det finns några animaliska ingredienser (mjölk, ägg, kött, etc.)\n\nSvara ENDAST med JSON-data enligt formatet ovan. Lägg inte till några förklaringar eller övrig text.","provider":"gemini","service":"koalens-backend","timestamp":"2025-03-29T11:40:11.663Z"}

warn: Gemini API call failed, retrying... {"errorMessage":"[GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro-exp-03-25:generateContent: [500 Internal Server Error] An internal error has occurred. Please retry or report in https://developers.generativeai.google/guide/troubleshooting","retriesLeft":2,"retryDelay":1000,"service":"koalens-backend","timestamp":"2025-03-29T11:40:13.188Z"}

warn: Gemini API call failed, retrying... {"errorMessage":"[GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro-exp-03-25:generateContent: [429 Too Many Requests] You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [{\"@type\":\"type.googleapis.com/google.rpc.QuotaFailure\",\"violations\":[{\"quotaMetric\":\"generativelanguage.googleapis.com/generate_requests_per_model\",\"quotaId\":\"GenerateRequestsPerMinutePerProjectPerModel\",\"quotaDimensions\":{\"location\":\"global\",\"model\":\"gemini-2.0-pro-exp\"},\"quotaValue\":\"5\"}]},{\"@type\":\"type.googleapis.com/google.rpc.Help\",\"links\":[{\"description\":\"Learn more about Gemini API quotas\",\"url\":\"https://ai.google.dev/gemini-api/docs/rate-limits\"}]},{\"@type\":\"type.googleapis.com/google.rpc.RetryInfo\",\"retryDelay\":\"38s\"}]","retriesLeft":2,"retryDelay":4000,"service":"koalens-backend","timestamp":"2025-03-29T11:40:24.342Z"}

error: Gemini API call failed after retries {"error":"[GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro-exp-03-25:generateContent: [429 Too Many Requests] You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [{\"@type\":\"type.googleapis.com/google.rpc.QuotaFailure\",\"violations\":[{\"quotaMetric\":\"generativelanguage.googleapis.com/generate_requests_per_model\",\"quotaId\":\"GenerateRequestsPerMinutePerProjectPerModel\",\"quotaDimensions\":{\"location\":\"global\",\"model\":\"gemini-2.0-pro-exp\"},\"quotaValue\":\"5\"}]},{\"@type\":\"type.googleapis.com/google.rpc.Help\",\"links\":[{\"description\":\"Learn more about Gemini API quotas\",\"url\":\"https://ai.google.dev/gemini-api/docs/rate-limits\"}]},{\"@type\":\"type.googleapis.com/google.rpc.RetryInfo\",\"retryDelay\":\"28s\"}]","service":"koalens-backend","timestamp":"2025-03-29T11:40:34.646Z"}

error: Error analyzing video {"error":"[GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro-exp-03-25:generateContent: [429 Too Many Requests] You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [{\"@type\":\"type.googleapis.com/google.rpc.QuotaFailure\",\"violations\":[{\"quotaMetric\":\"generativelanguage.googleapis.com/generate_requests_per_model\",\"quotaId\":\"GenerateRequestsPerMinutePerProjectPerModel\",\"quotaDimensions\":{\"location\":\"global\",\"model\":\"gemini-2.0-pro-exp\"},\"quotaValue\":\"5\"}]},{\"@type\":\"type.googleapis.com/google.rpc.Help\",\"links\":[{\"description\":\"Learn more about Gemini API quotas\",\"url\":\"https://ai.google.dev/gemini-api/docs/rate-limits\"}]},{\"@type\":\"type.googleapis.com/google.rpc.RetryInfo\",\"retryDelay\":\"28s\"}]","service":"koalens-backend","stack":"Error: [GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro-exp-03-25:generateContent: [429 Too Many Requests] You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. [{\"@type\":\"type.googleapis.com/google.rpc.QuotaFailure\",\"violations\":[{\"quotaMetric\":\"generativelanguage.googleapis.com/generate_requests_per_model\",\"quotaId\":\"GenerateRequestsPerMinutePerProjectPerModel\",\"quotaDimensions\":{\"location\":\"global\",\"model\":\"gemini-2.0-pro-exp\"},\"quotaValue\":\"5\"}]},{\"@type\":\"type.googleapis.com/google.rpc.Help\",\"links\":[{\"description\":\"Learn more about Gemini API quotas\",\"url\":\"https://ai.google.dev/gemini-api/docs/rate-limits\"}]},{\"@type\":\"type.googleapis.com/google.rpc.RetryInfo\",\"retryDelay\":\"28s\"}]\n    at handleResponseNotOk (C:\\Projects\\koalens-backend\\node_modules\\@google\\generative-ai\\dist\\index.js:434:11)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at makeRequest (C:\\Projects\\koalens-backend\\node_modules\\@google\\generative-ai\\dist\\index.js:403:9)\n    at generateContent (C:\\Projects\\koalens-backend\\node_modules\\@google\\generative-ai\\dist\\index.js:867:22)\n    at C:\\Projects\\koalens-backend\\src\\services\\geminiService.ts:211:24\n    at GeminiService.withRetry (C:\\Projects\\koalens-backend\\src\\services\\geminiService.ts:98:14)\n    at VideoAnalysisService.analyzeVideo (C:\\Projects\\koalens-backend\\src\\services\\videoAnalysisService.ts:118:22)\n    at C:\\Projects\\koalens-backend\\src\\routes\\videoAnalysis.ts:62:20","timestamp":"2025-03-29T11:40:34.650Z"}

error: Gemini API call failed after retries {"error":"[GoogleGenerativeAI Error]: Error fetching from https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro-exp-03-25:generateContent: [500 Internal Server Error] An internal error has occurred. Please retry or report in https://developers.generativeai.google/guide/troubleshooting","service":"koalens-backend","timestamp":"2025-03-29T11:41:33.665Z"}