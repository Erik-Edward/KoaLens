info: Video analysis request received {"dataSize":13804732,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-04T20:33:47.011Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13804732,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-04T20:33:47.012Z"}
info: Video optimization completed {"compressionRatio":"3.10","optimizedSizeMB":"3.18","originalSizeMB":"9.87","service":"koalens-backend","timestamp":"2025-04-04T20:33:51.054Z"}
info: Sending video for AI analysis {"promptLength":1529,"service":"koalens-backend","timestamp":"2025-04-04T20:33:51.059Z","videoSizeKB":3257}
info: Attempting video analysis with function calling {"attempt":1,"service":"koalens-backend","timestamp":"2025-04-04T20:33:51.060Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":3335574,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser för att avgöra om produkten är vegansk.\n\nMÅLSPRÅK för översättning: Swedish (sv)\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Identifiera ingredienserna som tydligt VISAS på produktens förpackning.\n2. Använd verktyget 'recordIngredientAnalysis' för att strukturera och returnera ditt svar.\n3. För varje identifierad ingrediens:\n   a. Ange ingrediensens **originalnamn** (som det står på förpackningen) i fältet 'name'.\n   b. **Översätt originalnamnet till målspråket (Swedish)** och ange det i fältet 'translated_name'. Om du inte kan översätta, ange originalnamnet även i 'translated_name'.\n   c. Ange dess status: 'vegansk', 'icke-vegansk', 'osäker'.\n   d. SPECIFIK REGEL: Ingrediensen 'Arom' (eller motsvarande på andra språk) ska klassificeras som 'osäker' om dess ursprung inte specificeras.\n   e. Ange en konfidenspoäng (0.0-1.0) för statusklassificeringen.\n   f. VIKTIGT: För 'icke-vegansk' eller 'osäker' status, MÅSTE du ange en kort motivering ('reasoning').\n4. Ange produktens övergripande status ('sannolikt vegansk', 'sannolikt icke-vegansk', 'oklart') och en övergripande konfidenspoäng.\n5. Inkludera ALLA identifierade ingredienser, men lista varje unik ingrediens endast EN gång baserat på dess originalnamn.\n6. Basera din analys ENDAST på vad som FAKTISKT SYNS i videon.\n\nAnvänd verktyget 'recordIngredientAnalysis' för att returnera resultatet med både originalnamn ('name') och namn översatta till Swedish ('translated_name').\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-04T20:33:51.061Z","toolsProvided":true}
info: AI Response [gemini] {"completionTokens":0,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":382.25,"provider":"gemini","responseText":"","service":"koalens-backend","timestamp":"2025-04-04T20:33:55.504Z"}
info: Received function call from Gemini {"functionName":"recordIngredientAnalysis","service":"koalens-backend","timestamp":"2025-04-04T20:33:55.504Z"}
info: Function call arguments successfully validated against Zod schema. {"service":"koalens-backend","timestamp":"2025-04-04T20:33:55.508Z"}
info: Video analysis completed {"confidenceScore":0.7,"ingredientCount":9,"isUncertain":false,"isVegan":false,"operation":"response:success","processingTimeSec":0,"requestId":"not-provided","service":"videoAnalysis","statusCode":200,"timestamp":"2025-04-04T20:33:55.511Z","uncertainIngredientsCount":2}  
info: Video analysis completed by service {"ingredientCount":9,"isUncertain":false,"isVegan":false,"processingTimeSec":"8.50","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-04T20:33:55.514Z"}