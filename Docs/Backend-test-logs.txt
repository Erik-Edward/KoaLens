info: Sending video for AI analysis {"promptLength":1574,"service":"koalens-backend","timestamp":"2025-03-30T12:11:43.604Z","videoSizeKB":6507}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":6663600,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser.\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Leta efter alla ingredienser som visas på förpackningen.\n2. Titta igenom hela videon. Om det finns en ingredienslista eller näringsinnehåll, fokusera på den.\n3. Identifiera ALLA ord i ingredienslistan. Var extra uppmärksam på korta ingredienser som \"salt\", \"olja\", \"vatten\", etc.\n4. Var speciellt noggrann med att identifiera alla animaliska ingredienser.\n5. Missa inte vanliga ingredienser som \"palmolja\", \"salt\", \"socker\", \"konserveringsmedel\" etc.\n6. Översätt inte ingredienserna - använd dem exakt som de är skrivna.\n\nSVARA ENDAST MED ETT JSON-OBJEKT i detta format:\n```json\n{\n  \"ingredients\": [\n    {\n      \"name\": \"ingrediensnamn\",\n      \"isVegan\": true/false,\n      \"confidence\": 0.0-1.0\n    },\n    ...\n  ],\n  \"isVegan\": true/false,\n  \"confidence\": 0.0-1.0\n}\n```\n\nEXEMPEL PÅ KORREKT SVAR:\n```json\n{\n  \"ingredients\": [\n    {\n      \"name\": \"Majskorn\",\n      \"isVegan\": true,\n      \"confidence\": 0.98\n    },\n    {\n      \"name\": \"Palmolja\",\n      \"isVegan\": true,\n      \"confidence\": 0.95\n    },\n    {\n      \"name\": \"Salt\",\n      \"isVegan\": true,\n      \"confidence\": 0.99\n    }\n  ],\n  \"isVegan\": true,\n  \"confidence\": 0.97\n}\n```\n\nSe till att:\n1. ALLTID följa det exakta JSON-formatet\n2. Ordningen på fälten ska vara: \"name\", \"isVegan\", \"confidence\" för varje ingrediens\n3. Identifiera ALLA ingredienser, även de kortaste som \"salt\"\n4. Ange \"confidence\" som ett nummer mellan 0 och 1\n5. Inkludera ALLA ingredienser du kan identifiera i videon\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-03-30T12:11:43.604Z"}
info: AI Response [gemini] {"completionTokens":1541,"mediaTokens":"Video content","promptTokens":393.5,"provider":"gemini","responseText":"```json\n{\n  \"ingredients\": [\n    {\n      \"name\": \"TARWEBLOEM\",\n      \"isVegan\": true,\n      \"confide...","service":"koalens-backend","timestamp":"2025-03-30T12:11:54.886Z"}  
info: Parsed ingredients data {"ingredientsData":"[{\"name\":\"TARWEBLOEM\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"palmolie\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"glucosestroop\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"rijsmiddelen (ammoniumcarbonaten, natriumcarbonaten)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"zout\",\"isVegan\":true,\"confidence\":0.99},{\"name\":\"suiker\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"dextrose\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"uienpoeder 0,5%\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"natuurlijk aroma\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"zure ROOMPOEDER 0,1%\",\"isVegan\":false,\"confidence\":0.95},{\"name\":\"voedingszuren (citroenzuur, calciumlactaat)\",\"isVegan\":false,\"confidence\":0.85},{\"name\":\"meelverbeteraar (NATRIUMDISULFIET)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"Farine de BLE\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"huile de palme\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"sirop de glucose\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"poudres à lever (carbonates d'ammonium, carbonates de sodium)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"sel\",\"isVegan\":true,\"confidence\":0.99},{\"name\":\"sucre\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"dextrose\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"oignon en poudre 0,5%\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"arôme naturel\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"CRÈME aigre en poudre 0,1%\",\"isVegan\":false,\"confidence\":0.95},{\"name\":\"acidifiants (acide citrique, lactate de calcium)\",\"isVegan\":false,\"confidence\":0.85},{\"name\":\"agent de traitement de la farine (DISULFITE de sodium)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"WEIZENMEHL\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"Palmöl\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"Glukosesirup\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"Backtriebmittel (Ammoniumcarbonate, Natriumcarbonate)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"Speisesalz\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"Zucker\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"Traubenzucker\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"Zwiebelpulver 0,5%\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"natürliches Aroma\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"SAUERRAHMPULVER 0,1%\",\"isVegan\":false,\"confidence\":0.95},{\"name\":\"Säuerungsmittel (Citronensäure, Calciumlactat)\",\"isVegan\":false,\"confidence\":0.85},{\"name\":\"Mehlbehandlungsmittel (NATRIUMMETABISULFIT)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"farina di FRUMENTO\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"olio di palma\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"sciroppo di glucosio\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"agenti lievitanti (carbonati di ammonio, carbonati di sodio)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"sale\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"zucchero\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"destrosio\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"cipolla in polvere 0,5%\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"aroma naturale\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"panna acida in polvere (da LATTE) 0,1%\",\"isVegan\":false,\"confidence\":0.95},{\"name\":\"acidificanti (acido citrico, lattato di calcio)\",\"isVegan\":false,\"confidence\":0.85},{\"name\":\"agente di trattamento della farina (METABISOLFITO di sodio)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"harina de TRIGO\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"grasa de palma\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"jarabe de glucosa\",\"isVegan\":true,\"confidence\":0.95},{\"name\":\"gasificantes (carbonatos de amonio, carbonatos de sodio)\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"sal\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"azúcar\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"dextrosa\",\"isVegan\":true,\"confidence\":0.98},{\"name\":\"cebolla en polvo 0,5%\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"aroma natural\",\"isVegan\":true,\"confidence\":0.9},{\"name\":\"NATA ácida en polvo 0,1%\",\"isVegan\":false,\"confidence\":0.95},{\"name\":\"acidulantes (ácido cítrico, lactato cálcico)\",\"isVegan\":false,\"confidence\":0.85},{\"name\":\"agente de tratamiento de la harina (METABISULFITO sódico)\",\"isVegan\":true,\"confidence\":0.9}]","service":"koalens-backend","timestamp":"2025-03-30T12:11:54.887Z"}
info: Video analysis completed successfully {"confidence":0.7,"ingredientCount":60,"isVegan":false,"service":"koalens-backend","timestamp":"2025-03-30T12:11:54.887Z"}