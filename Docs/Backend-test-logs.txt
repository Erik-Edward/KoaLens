info: Video analysis request received {"dataSize":13779264,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:29.957Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13779264,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-02T09:19:29.958Z"}
info: Video analysis request received {"dataSize":13779264,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:32.299Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13779264,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-02T09:19:32.300Z"}
info: Video analysis request received {"dataSize":13779264,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:32.887Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13779264,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-02T09:19:32.889Z"}
info: Video optimization completed {"compressionRatio":"2.63","optimizedSizeMB":"3.75","originalSizeMB":"9.86","service":"koalens-backend","timestamp":"2025-04-02T09:19:35.557Z"}
info: Sending video for AI analysis {"promptLength":1628,"service":"koalens-backend","timestamp":"2025-04-02T09:19:35.637Z","videoSizeKB":3837}
info: Attempting video analysis with function calling {"attempt":1,"service":"koalens-backend","timestamp":"2025-04-02T09:19:35.653Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":3929142,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser för att avgöra om produkten är vegansk.\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Identifiera ingredienserna som tydligt VISAS på produktens förpackning, främst i ingredienslistan.\n2. Översätt ALLA identifierade ingredienser till svenska. Använd vanliga svenska livsmedelsnamn.\n3. Använd verktyget 'recordIngredientAnalysis' för att strukturera och returnera ditt svar.\n4. För varje identifierad ingrediens, ange dess status:\n   - 'vegansk': Om ingrediensen är växtbaserad eller syntetisk.\n   - 'icke-vegansk': Om ingrediensen DEFINITIVT kommer från djur (t.ex. mjölk, ägg, kött, gelatin, honung, E120, E441, E901, E904, L-cystein).\n   - 'osäker': Om ingrediensens ursprung är oklart eller kan variera (t.ex. vissa E-nummer som E471, mono- och diglycerider, lecitin om ej specificerat som soja).\n5. SPECIFIK REGEL: Ingrediensen 'Arom' ska klassificeras som 'osäker' om dess ursprung (t.ex. 'naturlig arom från växtriket') inte specificeras.\n6. För varje ingrediens, ange en konfidenspoäng (0.0-1.0) för din klassificering (status).\n7. VIKTIGT: För varje ingrediens med status 'icke-vegansk' eller 'osäker', MÅSTE du ange en kort motivering ('reasoning') som förklarar varför.\n8. Ange produktens övergripande status ('sannolikt vegansk', 'sannolikt icke-vegansk', 'oklart') och en övergripande konfidenspoäng.\n9. Inkludera ALLA identifierade ingredienser, men lista varje unik ingrediens endast EN gång.\n10. Basera din analys ENDAST på vad som FAKTISKT SYNS i videon.\n\nAnvänd verktyget 'recordIngredientAnalysis' för att returnera resultatet.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-02T09:19:35.662Z","toolsProvided":true}
info: Video optimization completed {"compressionRatio":"2.63","optimizedSizeMB":"3.75","originalSizeMB":"9.86","service":"koalens-backend","timestamp":"2025-04-02T09:19:40.541Z"}
info: Sending video for AI analysis {"promptLength":1628,"service":"koalens-backend","timestamp":"2025-04-02T09:19:40.547Z","videoSizeKB":3837}
info: Attempting video analysis with function calling {"attempt":1,"service":"koalens-backend","timestamp":"2025-04-02T09:19:40.554Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":3929142,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser för att avgöra om produkten är vegansk.\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Identifiera ingredienserna som tydligt VISAS på produktens förpackning, främst i ingredienslistan.\n2. Översätt ALLA identifierade ingredienser till svenska. Använd vanliga svenska livsmedelsnamn.\n3. Använd verktyget 'recordIngredientAnalysis' för att strukturera och returnera ditt svar.\n4. För varje identifierad ingrediens, ange dess status:\n   - 'vegansk': Om ingrediensen är växtbaserad eller syntetisk.\n   - 'icke-vegansk': Om ingrediensen DEFINITIVT kommer från djur (t.ex. mjölk, ägg, kött, gelatin, honung, E120, E441, E901, E904, L-cystein).\n   - 'osäker': Om ingrediensens ursprung är oklart eller kan variera (t.ex. vissa E-nummer som E471, mono- och diglycerider, lecitin om ej specificerat som soja).\n5. SPECIFIK REGEL: Ingrediensen 'Arom' ska klassificeras som 'osäker' om dess ursprung (t.ex. 'naturlig arom från växtriket') inte specificeras.\n6. För varje ingrediens, ange en konfidenspoäng (0.0-1.0) för din klassificering (status).\n7. VIKTIGT: För varje ingrediens med status 'icke-vegansk' eller 'osäker', MÅSTE du ange en kort motivering ('reasoning') som förklarar varför.\n8. Ange produktens övergripande status ('sannolikt vegansk', 'sannolikt icke-vegansk', 'oklart') och en övergripande konfidenspoäng.\n9. Inkludera ALLA identifierade ingredienser, men lista varje unik ingrediens endast EN gång.\n10. Basera din analys ENDAST på vad som FAKTISKT SYNS i videon.\n\nAnvänd verktyget 'recordIngredientAnalysis' för att returnera resultatet.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-02T09:19:40.556Z","toolsProvided":true}
info: Video optimization completed {"compressionRatio":"2.63","optimizedSizeMB":"3.75","originalSizeMB":"9.86","service":"koalens-backend","timestamp":"2025-04-02T09:19:41.357Z"}
info: Sending video for AI analysis {"promptLength":1628,"service":"koalens-backend","timestamp":"2025-04-02T09:19:41.361Z","videoSizeKB":3837}
info: Attempting video analysis with function calling {"attempt":1,"service":"koalens-backend","timestamp":"2025-04-02T09:19:41.362Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":3929142,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser för att avgöra om produkten är vegansk.\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Identifiera ingredienserna som tydligt VISAS på produktens förpackning, främst i ingredienslistan.\n2. Översätt ALLA identifierade ingredienser till svenska. Använd vanliga svenska livsmedelsnamn.\n3. Använd verktyget 'recordIngredientAnalysis' för att strukturera och returnera ditt svar.\n4. För varje identifierad ingrediens, ange dess status:\n   - 'vegansk': Om ingrediensen är växtbaserad eller syntetisk.\n   - 'icke-vegansk': Om ingrediensen DEFINITIVT kommer från djur (t.ex. mjölk, ägg, kött, gelatin, honung, E120, E441, E901, E904, L-cystein).\n   - 'osäker': Om ingrediensens ursprung är oklart eller kan variera (t.ex. vissa E-nummer som E471, mono- och diglycerider, lecitin om ej specificerat som soja).\n5. SPECIFIK REGEL: Ingrediensen 'Arom' ska klassificeras som 'osäker' om dess ursprung (t.ex. 'naturlig arom från växtriket') inte specificeras.\n6. För varje ingrediens, ange en konfidenspoäng (0.0-1.0) för din klassificering (status).\n7. VIKTIGT: För varje ingrediens med status 'icke-vegansk' eller 'osäker', MÅSTE du ange en kort motivering ('reasoning') som förklarar varför.\n8. Ange produktens övergripande status ('sannolikt vegansk', 'sannolikt icke-vegansk', 'oklart') och en övergripande konfidenspoäng.\n9. Inkludera ALLA identifierade ingredienser, men lista varje unik ingrediens endast EN gång.\n10. Basera din analys ENDAST på vad som FAKTISKT SYNS i videon.\n\nAnvänd verktyget 'recordIngredientAnalysis' för att returnera resultatet.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-02T09:19:41.362Z","toolsProvided":true}
info: AI Response [gemini] {"completionTokens":18.5,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":407,"provider":"gemini","responseText":"Här är en analys av ingredienserna baserat på informationen från videon:\n\n","service":"koalens-backend","timestamp":"2025-04-02T09:19:42.759Z"}
info: Received function call from Gemini {"functionName":"recordIngredientAnalysis","service":"koalens-backend","timestamp":"2025-04-02T09:19:42.759Z"}
info: Function call arguments successfully validated against Zod schema. {"service":"koalens-backend","timestamp":"2025-04-02T09:19:42.762Z"}
info: Video analysis completed {"confidenceScore":0.9,"ingredientCount":16,"isUncertain":false,"isVegan":false,"operation":"response:success","processingTimeSec":0,"requestId":"not-provided","service":"videoAnalysis","statusCode":200,"timestamp":"2025-04-02T09:19:42.763Z","uncertainIngredientsCount":1}
info: Video analysis completed {"ingredientCount":16,"isVegan":false,"processingTimeSec":"12.81","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:42.765Z"}
info: AI Response [gemini] {"completionTokens":13.75,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":407,"provider":"gemini","responseText":"Här är en analys av ingredienserna baserat på videon:\n\n","service":"koalens-backend","timestamp":"2025-04-02T09:19:45.429Z"} 
info: Received function call from Gemini {"functionName":"recordIngredientAnalysis","service":"koalens-backend","timestamp":"2025-04-02T09:19:45.430Z"}
info: Function call arguments successfully validated against Zod schema. {"service":"koalens-backend","timestamp":"2025-04-02T09:19:45.430Z"}
info: Video analysis completed {"confidenceScore":0.95,"ingredientCount":14,"isUncertain":false,"isVegan":false,"operation":"response:success","processingTimeSec":0,"requestId":"not-provided","service":"videoAnalysis","statusCode":200,"timestamp":"2025-04-02T09:19:45.431Z","uncertainIngredientsCount":1}
info: Video analysis completed {"ingredientCount":14,"isVegan":false,"processingTimeSec":"13.13","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:45.433Z"}
info: AI Response [gemini] {"completionTokens":18.5,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":407,"provider":"gemini","responseText":"Här är en analys av ingredienserna baserat på informationen från videon:\n\n","service":"koalens-backend","timestamp":"2025-04-02T09:19:46.110Z"}
info: Received function call from Gemini {"functionName":"recordIngredientAnalysis","service":"koalens-backend","timestamp":"2025-04-02T09:19:46.111Z"}
info: Function call arguments successfully validated against Zod schema. {"service":"koalens-backend","timestamp":"2025-04-02T09:19:46.111Z"}
info: Video analysis completed {"confidenceScore":0.9,"ingredientCount":14,"isUncertain":false,"isVegan":false,"operation":"response:success","processingTimeSec":0,"requestId":"not-provided","service":"videoAnalysis","statusCode":200,"timestamp":"2025-04-02T09:19:46.112Z","uncertainIngredientsCount":1}
info: Video analysis completed {"ingredientCount":14,"isVegan":false,"processingTimeSec":"13.23","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:46.114Z"}
info: Video analysis request received {"dataSize":13779264,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:46.267Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13779264,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-02T09:19:46.267Z"}
info: Video analysis request received {"dataSize":13779264,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:49.291Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13779264,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-02T09:19:49.293Z"}
info: Video optimization completed {"compressionRatio":"2.63","optimizedSizeMB":"3.75","originalSizeMB":"9.86","service":"koalens-backend","timestamp":"2025-04-02T09:19:49.912Z"}
info: Sending video for AI analysis {"promptLength":1628,"service":"koalens-backend","timestamp":"2025-04-02T09:19:49.919Z","videoSizeKB":3837}
info: Attempting video analysis with function calling {"attempt":1,"service":"koalens-backend","timestamp":"2025-04-02T09:19:49.920Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":3929142,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser för att avgöra om produkten är vegansk.\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Identifiera ingredienserna som tydligt VISAS på produktens förpackning, främst i ingredienslistan.\n2. Översätt ALLA identifierade ingredienser till svenska. Använd vanliga svenska livsmedelsnamn.\n3. Använd verktyget 'recordIngredientAnalysis' för att strukturera och returnera ditt svar.\n4. För varje identifierad ingrediens, ange dess status:\n   - 'vegansk': Om ingrediensen är växtbaserad eller syntetisk.\n   - 'icke-vegansk': Om ingrediensen DEFINITIVT kommer från djur (t.ex. mjölk, ägg, kött, gelatin, honung, E120, E441, E901, E904, L-cystein).\n   - 'osäker': Om ingrediensens ursprung är oklart eller kan variera (t.ex. vissa E-nummer som E471, mono- och diglycerider, lecitin om ej specificerat som soja).\n5. SPECIFIK REGEL: Ingrediensen 'Arom' ska klassificeras som 'osäker' om dess ursprung (t.ex. 'naturlig arom från växtriket') inte specificeras.\n6. För varje ingrediens, ange en konfidenspoäng (0.0-1.0) för din klassificering (status).\n7. VIKTIGT: För varje ingrediens med status 'icke-vegansk' eller 'osäker', MÅSTE du ange en kort motivering ('reasoning') som förklarar varför.\n8. Ange produktens övergripande status ('sannolikt vegansk', 'sannolikt icke-vegansk', 'oklart') och en övergripande konfidenspoäng.\n9. Inkludera ALLA identifierade ingredienser, men lista varje unik ingrediens endast EN gång.\n10. Basera din analys ENDAST på vad som FAKTISKT SYNS i videon.\n\nAnvänd verktyget 'recordIngredientAnalysis' för att returnera resultatet.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-02T09:19:49.920Z","toolsProvided":true}
info: Video analysis request received {"dataSize":13779264,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:50.635Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13779264,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-02T09:19:50.636Z"}
info: Video optimization completed {"compressionRatio":"2.63","optimizedSizeMB":"3.75","originalSizeMB":"9.86","service":"koalens-backend","timestamp":"2025-04-02T09:19:54.818Z"}
info: Sending video for AI analysis {"promptLength":1628,"service":"koalens-backend","timestamp":"2025-04-02T09:19:54.824Z","videoSizeKB":3837}
info: Attempting video analysis with function calling {"attempt":1,"service":"koalens-backend","timestamp":"2025-04-02T09:19:54.824Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":3929142,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser för att avgöra om produkten är vegansk.\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Identifiera ingredienserna som tydligt VISAS på produktens förpackning, främst i ingredienslistan.\n2. Översätt ALLA identifierade ingredienser till svenska. Använd vanliga svenska livsmedelsnamn.\n3. Använd verktyget 'recordIngredientAnalysis' för att strukturera och returnera ditt svar.\n4. För varje identifierad ingrediens, ange dess status:\n   - 'vegansk': Om ingrediensen är växtbaserad eller syntetisk.\n   - 'icke-vegansk': Om ingrediensen DEFINITIVT kommer från djur (t.ex. mjölk, ägg, kött, gelatin, honung, E120, E441, E901, E904, L-cystein).\n   - 'osäker': Om ingrediensens ursprung är oklart eller kan variera (t.ex. vissa E-nummer som E471, mono- och diglycerider, lecitin om ej specificerat som soja).\n5. SPECIFIK REGEL: Ingrediensen 'Arom' ska klassificeras som 'osäker' om dess ursprung (t.ex. 'naturlig arom från växtriket') inte specificeras.\n6. För varje ingrediens, ange en konfidenspoäng (0.0-1.0) för din klassificering (status).\n7. VIKTIGT: För varje ingrediens med status 'icke-vegansk' eller 'osäker', MÅSTE du ange en kort motivering ('reasoning') som förklarar varför.\n8. Ange produktens övergripande status ('sannolikt vegansk', 'sannolikt icke-vegansk', 'oklart') och en övergripande konfidenspoäng.\n9. Inkludera ALLA identifierade ingredienser, men lista varje unik ingrediens endast EN gång.\n10. Basera din analys ENDAST på vad som FAKTISKT SYNS i videon.\n\nAnvänd verktyget 'recordIngredientAnalysis' för att returnera resultatet.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-02T09:19:54.825Z","toolsProvided":true}
info: AI Response [gemini] {"completionTokens":0,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":407,"provider":"gemini","responseText":"","service":"koalens-backend","timestamp":"2025-04-02T09:19:55.066Z"}
info: Received function call from Gemini {"functionName":"recordIngredientAnalysis","service":"koalens-backend","timestamp":"2025-04-02T09:19:55.067Z"}
info: Function call arguments successfully validated against Zod schema. {"service":"koalens-backend","timestamp":"2025-04-02T09:19:55.069Z"}
info: Video analysis completed {"confidenceScore":0.9,"ingredientCount":15,"isUncertain":false,"isVegan":false,"operation":"response:success","processingTimeSec":0,"requestId":"not-provided","service":"videoAnalysis","statusCode":200,"timestamp":"2025-04-02T09:19:55.070Z","uncertainIngredientsCount":1}
info: Video analysis completed {"ingredientCount":15,"isVegan":false,"processingTimeSec":"8.81","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:55.075Z"}
info: Video optimization completed {"compressionRatio":"2.63","optimizedSizeMB":"3.75","originalSizeMB":"9.86","service":"koalens-backend","timestamp":"2025-04-02T09:19:55.973Z"}
info: Sending video for AI analysis {"promptLength":1628,"service":"koalens-backend","timestamp":"2025-04-02T09:19:55.976Z","videoSizeKB":3837}
info: Attempting video analysis with function calling {"attempt":1,"service":"koalens-backend","timestamp":"2025-04-02T09:19:55.977Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":3929142,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser för att avgöra om produkten är vegansk.\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Identifiera ingredienserna som tydligt VISAS på produktens förpackning, främst i ingredienslistan.\n2. Översätt ALLA identifierade ingredienser till svenska. Använd vanliga svenska livsmedelsnamn.\n3. Använd verktyget 'recordIngredientAnalysis' för att strukturera och returnera ditt svar.\n4. För varje identifierad ingrediens, ange dess status:\n   - 'vegansk': Om ingrediensen är växtbaserad eller syntetisk.\n   - 'icke-vegansk': Om ingrediensen DEFINITIVT kommer från djur (t.ex. mjölk, ägg, kött, gelatin, honung, E120, E441, E901, E904, L-cystein).\n   - 'osäker': Om ingrediensens ursprung är oklart eller kan variera (t.ex. vissa E-nummer som E471, mono- och diglycerider, lecitin om ej specificerat som soja).\n5. SPECIFIK REGEL: Ingrediensen 'Arom' ska klassificeras som 'osäker' om dess ursprung (t.ex. 'naturlig arom från växtriket') inte specificeras.\n6. För varje ingrediens, ange en konfidenspoäng (0.0-1.0) för din klassificering (status).\n7. VIKTIGT: För varje ingrediens med status 'icke-vegansk' eller 'osäker', MÅSTE du ange en kort motivering ('reasoning') som förklarar varför.\n8. Ange produktens övergripande status ('sannolikt vegansk', 'sannolikt icke-vegansk', 'oklart') och en övergripande konfidenspoäng.\n9. Inkludera ALLA identifierade ingredienser, men lista varje unik ingrediens endast EN gång.\n10. Basera din analys ENDAST på vad som FAKTISKT SYNS i videon.\n\nAnvänd verktyget 'recordIngredientAnalysis' för att returnera resultatet.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-02T09:19:55.977Z","toolsProvided":true}
info: Video analysis request received {"dataSize":13779264,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-02T09:19:58.624Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13779264,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-02T09:19:58.625Z"}