info: Video analysis request received {"dataSize":13981180,"mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-03T08:50:40.006Z"}
info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13981180,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-03T08:50:40.007Z"}
info: Video optimization completed {"compressionRatio":"3.54","optimizedSizeMB":"2.83","originalSizeMB":"10.00","service":"koalens-backend","timestamp":"2025-04-03T08:50:43.702Z"}
info: Sending video for AI analysis {"promptLength":1628,"service":"koalens-backend","timestamp":"2025-04-03T08:50:43.707Z","videoSizeKB":2894}
info: Attempting video analysis with function calling {"attempt":1,"service":"koalens-backend","timestamp":"2025-04-03T08:50:43.707Z"}
info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":1536,"temperature":0.2,"topK":40,"topP":0.95},"mediaSizeBytes":2963862,"mediaType":"video/mp4","prompt":"\nDu är en expert på att analysera matprodukter och identifiera deras ingredienser för att avgöra om produkten är vegansk.\n\nINSTRUKTIONER:\n1. Analysera videon NOGGRANT. Identifiera ingredienserna som tydligt VISAS på produktens förpackning, främst i ingredienslistan.\n2. Översätt ALLA identifierade ingredienser till svenska. Använd vanliga svenska livsmedelsnamn.\n3. Använd verktyget 'recordIngredientAnalysis' för att strukturera och returnera ditt svar.\n4. För varje identifierad ingrediens, ange dess status:\n   - 'vegansk': Om ingrediensen är växtbaserad eller syntetisk.\n   - 'icke-vegansk': Om ingrediensen DEFINITIVT kommer från djur (t.ex. mjölk, ägg, kött, gelatin, honung, E120, E441, E901, E904, L-cystein).\n   - 'osäker': Om ingrediensens ursprung är oklart eller kan variera (t.ex. vissa E-nummer som E471, mono- och diglycerider, lecitin om ej specificerat som soja).\n5. SPECIFIK REGEL: Ingrediensen 'Arom' ska klassificeras som 'osäker' om dess ursprung (t.ex. 'naturlig arom från växtriket') inte specificeras.\n6. För varje ingrediens, ange en konfidenspoäng (0.0-1.0) för din klassificering (status).\n7. VIKTIGT: För varje ingrediens med status 'icke-vegansk' eller 'osäker', MÅSTE du ange en kort motivering ('reasoning') som förklarar varför.\n8. Ange produktens övergripande status ('sannolikt vegansk', 'sannolikt icke-vegansk', 'oklart') och en övergripande konfidenspoäng.\n9. Inkludera ALLA identifierade ingredienser, men lista varje unik ingrediens endast EN gång.\n10. Basera din analys ENDAST på vad som FAKTISKT SYNS i videon.\n\nAnvänd verktyget 'recordIngredientAnalysis' för att returnera resultatet.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-03T08:50:43.709Z","toolsProvided":true}
info: AI Response [gemini] {"completionTokens":0,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":407,"provider":"gemini","responseText":"","service":"koalens-backend","timestamp":"2025-04-03T08:50:46.571Z"}
info: Received function call from Gemini {"functionName":"recordIngredientAnalysis","service":"koalens-backend","timestamp":"2025-04-03T08:50:46.572Z"}
info: Function call arguments successfully validated against Zod schema. {"service":"koalens-backend","timestamp":"2025-04-03T08:50:46.574Z"}
info: Video analysis completed {"confidenceScore":0.9,"ingredientCount":3,"isUncertain":false,"isVegan":true,"operation":"response:success","processingTimeSec":0,"requestId":"not-provided","service":"videoAnalysis","statusCode":200,"timestamp":"2025-04-03T08:50:46.575Z","uncertainIngredientsCount":0}
info: Video analysis completed {"ingredientCount":3,"isVegan":true,"processingTimeSec":"6.57","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-03T08:50:46.578Z"}