2025-04-08T09:32:40.609 app[e286e727be9368] arn [info] Hämtar räknare "analysis_count" för användare: c1506b70-4298-4eec-8752-d67fd6153b47

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] Räknarinformation hämtad: {

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] counter_id: '8b692228-ca8a-40ce-bb0c-81afb5dfbe84',

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] user_id: 'c1506b70-4298-4eec-8752-d67fd6153b47',

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] counter_name: 'analysis_count',

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] value: 4,

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] limit: 15,

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] remaining: 11,

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] is_limited: true,

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] has_reached_limit: false,

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] reset_frequency: 'monthly',

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] last_reset: '2025-04-08T09:24:13.862269+00:00',

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] next_reset: '2025-05-08T09:24:13.862269+00:00'

2025-04-08T09:32:40.850 app[e286e727be9368] arn [info] }

2025-04-08T09:32:45.086 app[e286e727be9368] arn [info] info: Request received at /video/analyze-video endpoint {"baseUrl":"/api/video","bodyKeys":["base64Data","mimeType","preferredLanguage"],"contentLength":"13996279","contentType":"application/json","hasBase64Data":true,"hasBody":true,"hasMimeType":true,"method":"POST","originalUrl":"/api/video/analyze-video","path":"/analyze-video","service":"koalens-backend","timestamp":"2025-04-08T09:32:45.085Z"}

2025-04-08T09:32:45.169 app[e286e727be9368] arn [info] info: Video analysis request details {"bodyKeys":["base64Data","mimeType","preferredLanguage"],"bodySize":13996279,"hasBase64Data":true,"hasMimeType":true,"headers":{"accept":"application/json","content-length":"13996279","content-type":"application/json","user-agent":"okhttp/4.9.2"},"ip":"172.16.0.202","method":"POST","service":"koalens-backend","timestamp":"2025-04-08T09:32:45.164Z","url":"/api/video/analyze-video"}

2025-04-08T09:32:45.169 app[e286e727be9368] arn [info] info: Video analysis request received {"dataSize":13996208,"endpoint":"/api/video/analyze-video","mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-08T09:32:45.164Z"}

2025-04-08T09:32:45.169 app[e286e727be9368] arn [info] info: Video analysis request received {"dataSize":13996208,"hasApiKey":true,"mimeType":"video/quicktime","model":"gemini-2.0-flash","preferredLanguage":"sv","service":"koalens-backend","timestamp":"2025-04-08T09:32:45.164Z"}

2025-04-08T09:32:45.169 app[e286e727be9368] arn [info] info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13996208,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-08T09:32:45.165Z"}

2025-04-08T09:32:45.174 app[e286e727be9368] arn [info] warn: Video is large, future optimizations should reduce size for faster processing {"service":"koalens-backend","timestamp":"2025-04-08T09:32:45.174Z","videoSizeMB":10}

2025-04-08T09:32:45.188 app[e286e727be9368] arn [info] info: Using aggressive video optimization for large video {"service":"koalens-backend","targetResolution":"240p","timestamp":"2025-04-08T09:32:45.188Z","videoSizeMB":10.01086711883545}

2025-04-08T09:32:45.188 app[e286e727be9368] arn [info] info: Using FAST optimization method for medium video {"service":"koalens-backend","timestamp":"2025-04-08T09:32:45.188Z","videoSizeMB":10.01086711883545}

2025-04-08T09:32:47.408 app[e286e727be9368] arn [info] info: Fast video optimization completed {"compressionRatio":"31.62","method":"fast","optimizedSizeMB":"0.32","originalSizeMB":"10.01","service":"koalens-backend","timestamp":"2025-04-08T09:32:47.408Z"}

2025-04-08T09:32:47.408 app[e286e727be9368] arn [info] info: Video optimization completed {"compressionRatio":"31.62","optimizedSizeMB":"0.32","originalSizeMB":"10.01","service":"koalens-backend","timestamp":"2025-04-08T09:32:47.408Z"}

2025-04-08T09:32:47.409 app[e286e727be9368] arn [info] info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":3072,"temperature":0.4,"topK":40,"topP":0.8},"mediaSizeBytes":331995,"mediaType":"video/quicktime","prompt":"\nAnalysera videon för att snabbt identifiera ingredienser på produktens förpackning.\n\nSPRÅK: sv\n\nUPPGIFT:\n1. Identifiera ingredienser som visas på förpackningen\n2. Klassificera varje ingrediens som \"vegansk\", \"icke-vegansk\" eller \"osäker\"\n3. Ange en konfidenspoäng (0.0-1.0) för varje klassificering\n4. Ge en övergripande bedömning av produkten\n5. Använd verktyget \"recordIngredientAnalysis\" för att strukturera svaret\n\nFokusera enbart på vad som faktiskt visas i videon.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-08T09:32:47.409Z","toolsProvided":true}

2025-04-08T09:32:49.158 app[e286e727be9368] arn [info] info: AI Response [gemini] {"completionTokens":0,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":118,"provider":"gemini","responseText":"","service":"koalens-backend","timestamp":"2025-04-08T09:32:49.158Z"}

2025-04-08T09:32:49.159 app[e286e727be9368] arn [info] info: Gemini API call completed {"geminiApiCallMs":1750,"service":"koalens-backend","timestamp":"2025-04-08T09:32:49.159Z","totalElapsedMs":3995}

2025-04-08T09:32:49.162 app[e286e727be9368] arn [info] info: Video analysis completed by service {"ingredientCount":3,"isUncertain":false,"isVegan":false,"processingTimeSec":"4.08","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-08T09:32:49.161Z"}

2025-04-08T09:32:49.162 app[e286e727be9368] arn [info] info: Sending analysis response to client {"confidence":0.9,"ingredientCount":3,"isUncertain":false,"isVegan":false,"nonVeganCount":1,"problemIngredient":"Milk","responseData":"{\"success\":true,\"result\":{\"isVegan\":false,\"isUncertain\":false,\"confidence\":0.9,\"status\":\"icke-vegansk\",\"statusColor\":\"red\",\"ingredientList\":[\"Corn\",\"Milk\",\"E304\"],\"ingredientsWithStatus\":[{\"name\":\"Corn\",\"isVegan\":true,\"isUncertain\":false,\"status\":\"vegan\",\"statusColor\":\"green\",\"description\":\"Ingrediensen \\\"Corn\\\" är vegansk.\"},{\"name\":\"Milk\",\"isVegan\":false,\"isUncertain\":false,\"status\":\"non-vegan\",\"statusColor\":\"red\",\"description\":\"Ingrediensen \\\"Milk\\\" är inte vegansk.\"},{\"name\":\"E304\",\"isVegan\":false,\"isUncertain\":true,\"status\":\"uncertain\",\"statusColor\":\"orange\",\"description\":\"Ingrediensen \\\"E304\\\" kan vara vegansk eller icke-vegansk.\"}],\"watchedIngredients\":[{\"name\":\"Milk\",\"status\":\"non-vegan\",\"statusColor\":\"red\",\"description\":\"Ingrediensen \\\"Milk\\\" är inte vegansk.\"},{\"name\":\"E304\",\"status\":\"uncertain\",\"statusColor\":\"orange\",\"description\":\"Ingrediensen \\\"E304\\\" kan vara vegansk eller icke-vegansk.\"}],\"veganIngredients\":[\"Corn\"],\"nonVeganIngredients\":[\"Milk\"],\"uncertainIngredients\":[\"E304\"],\"problemIngredient\":\"Milk\",\"uncertainReasons\":[],\"reasoning\":\"Innehåller icke-veganska ingredienser: Milk.\"}}","service":"koalens-backend","status":"icke-vegansk","timestamp":"2025-04-08T09:32:49.161Z","uncertainCount":1,"veganCount":1}

2025-04-08T09:32:49.431 app[e286e727be9368] arn [info] Ökar räknare "analysis_count" för användare: c1506b70-4298-4eec-8752-d67fd6153b47

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] Räknare ökad: {

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] limit: 15,

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] value: 5,

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] user_id: 'c1506b70-4298-4eec-8752-d67fd6153b47',

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] remaining: 10,

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] counter_id: '8b692228-ca8a-40ce-bb0c-81afb5dfbe84',

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] is_limited: true,

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] last_reset: '2025-04-08T09:24:13.862269+00:00',

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] next_reset: '2025-05-08T09:24:13.862269+00:00',

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] counter_name: 'analysis_count',

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] reset_frequency: 'monthly',

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] has_reached_limit: false

2025-04-08T09:32:49.555 app[e286e727be9368] arn [info] }

2025-04-08T09:32:53.193 app[e286e727be9368] arn [info] warn: Video optimization timed out, using original video {"service":"koalens-backend","timestamp":"2025-04-08T09:32:53.193Z"}