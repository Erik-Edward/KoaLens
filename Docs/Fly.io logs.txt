2025-04-08T14:24:18.438 app[6e822504c7e598] arn [info] Hämtar räknare "analysis_count" för användare: a55a792d-dd3f-49b1-85b3-6264423809c1

2025-04-08T14:24:18.452 app[6e822504c7e598] arn [info] info: Health check endpoint accessed {"service":"koalens-backend","timestamp":"2025-04-08T14:24:18.452Z"}

2025-04-08T14:24:18.452 app[e286e727be9368] arn [info] Hämtar räknare "analysis_count" för användare: a55a792d-dd3f-49b1-85b3-6264423809c1

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] Räknarinformation hämtad: {

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] counter_id: 'c41ab73d-c43d-4368-b193-20e76ffb8f4e',

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] user_id: 'a55a792d-dd3f-49b1-85b3-6264423809c1',

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] counter_name: 'analysis_count',

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] value: 6,

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] limit: 15,

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] remaining: 9,

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] is_limited: true,

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] has_reached_limit: false,

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] reset_frequency: 'monthly',

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] last_reset: '2025-04-08T11:10:07.5617+00:00',

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] next_reset: '2025-05-08T11:10:07.5617+00:00'

2025-04-08T14:24:18.503 app[6e822504c7e598] arn [info] }

2025-04-08T14:24:18.521 app[e286e727be9368] arn [info] Räknarinformation hämtad: {

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] counter_id: 'c41ab73d-c43d-4368-b193-20e76ffb8f4e',

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] user_id: 'a55a792d-dd3f-49b1-85b3-6264423809c1',

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] counter_name: 'analysis_count',

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] value: 6,

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] limit: 15,

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] remaining: 9,

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] is_limited: true,

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] has_reached_limit: false,

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] reset_frequency: 'monthly',

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] last_reset: '2025-04-08T11:10:07.5617+00:00',

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] next_reset: '2025-05-08T11:10:07.5617+00:00'

2025-04-08T14:24:18.522 app[e286e727be9368] arn [info] }

2025-04-08T14:24:23.060 app[e286e727be9368] arn [info] info: Request received at /video/analyze-video endpoint {"baseUrl":"/api/video","bodyKeys":["base64Data","mimeType","preferredLanguage"],"contentLength":"13887735","contentType":"application/json","hasBase64Data":true,"hasBody":true,"hasMimeType":true,"method":"POST","originalUrl":"/api/video/analyze-video","path":"/analyze-video","service":"koalens-backend","timestamp":"2025-04-08T14:24:23.059Z"}

2025-04-08T14:24:23.157 app[e286e727be9368] arn [info] info: Video analysis request details {"bodyKeys":["base64Data","mimeType","preferredLanguage"],"bodySize":13887735,"hasBase64Data":true,"hasMimeType":true,"headers":{"accept":"application/json","content-length":"13887735","content-type":"application/json","user-agent":"okhttp/4.9.2"},"ip":"172.16.0.202","method":"POST","service":"koalens-backend","timestamp":"2025-04-08T14:24:23.155Z","url":"/api/video/analyze-video"}

2025-04-08T14:24:23.159 app[e286e727be9368] arn [info] info: Video analysis request received {"dataSize":13887664,"endpoint":"/api/video/analyze-video","mimeType":"video/quicktime","preferredLanguage":"sv","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-08T14:24:23.157Z"}

2025-04-08T14:24:23.159 app[e286e727be9368] arn [info] info: Video analysis request received {"dataSize":13887664,"hasApiKey":true,"mimeType":"video/quicktime","model":"gemini-2.0-flash","preferredLanguage":"sv","service":"koalens-backend","timestamp":"2025-04-08T14:24:23.158Z"}

2025-04-08T14:24:23.159 app[e286e727be9368] arn [info] info: Video analysis request received {"clientInfo":{},"dataSizeBytes":13887664,"mimeType":"video/quicktime","operation":"request","preferredLanguage":"sv","requestId":"not-provided","service":"videoAnalysis","timestamp":"2025-04-08T14:24:23.158Z"}

2025-04-08T14:24:23.231 app[e286e727be9368] arn [info] info: Using aggressive video optimization for large video {"service":"koalens-backend","targetResolution":"240p","timestamp":"2025-04-08T14:24:23.231Z","videoSizeMB":9.933231353759766}

2025-04-08T14:24:23.231 app[e286e727be9368] arn [info] info: Using FAST optimization method for medium video {"service":"koalens-backend","timestamp":"2025-04-08T14:24:23.231Z","videoSizeMB":9.933231353759766}

2025-04-08T14:24:25.483 app[e286e727be9368] arn [info] info: Fast video optimization completed {"compressionRatio":"30.60","method":"fast","optimizedSizeMB":"0.32","originalSizeMB":"9.93","service":"koalens-backend","timestamp":"2025-04-08T14:24:25.483Z"}

2025-04-08T14:24:25.483 app[e286e727be9368] arn [info] info: Video optimization completed {"compressionRatio":"30.60","optimizedSizeMB":"0.32","originalSizeMB":"9.93","service":"koalens-backend","timestamp":"2025-04-08T14:24:25.483Z"}

2025-04-08T14:24:25.485 app[e286e727be9368] arn [info] info: AI Request [gemini] {"generationConfig":{"maxOutputTokens":3072,"temperature":0.4,"topK":40,"topP":0.8},"mediaSizeBytes":340347,"mediaType":"video/quicktime","prompt":"\nAnalysera videon för att snabbt identifiera ingredienser på produktens förpackning.\n\nSPRÅK: sv\n\nUPPGIFT:\n1. Identifiera ingredienser som visas på förpackningen\n2. Klassificera varje ingrediens som \"vegansk\", \"icke-vegansk\" eller \"osäker\"\n3. Ange en konfidenspoäng (0.0-1.0) för varje klassificering\n4. Ge en övergripande bedömning av produkten\n5. Använd verktyget \"recordIngredientAnalysis\" för att strukturera svaret\n\nFokusera enbart på vad som faktiskt visas i videon.\n","provider":"gemini","service":"koalens-backend","timestamp":"2025-04-08T14:24:25.485Z","toolsProvided":true}

2025-04-08T14:24:27.263 app[e286e727be9368] arn [info] info: AI Response [gemini] {"completionTokens":0,"functionCallNames":"recordIngredientAnalysis","functionCallPresent":true,"mediaTokens":"Video content","promptTokens":118,"provider":"gemini","responseText":"","service":"koalens-backend","timestamp":"2025-04-08T14:24:27.263Z"}

2025-04-08T14:24:27.271 app[e286e727be9368] arn [info] info: Gemini API call completed {"geminiApiCallMs":1783,"service":"koalens-backend","timestamp":"2025-04-08T14:24:27.267Z","totalElapsedMs":4109}

2025-04-08T14:24:27.271 app[e286e727be9368] arn [info] info: Raw validated AI function call arguments (validatedArgs): {"service":"koalens-backend","timestamp":"2025-04-08T14:24:27.269Z"}

2025-04-08T14:24:27.271 app[e286e727be9368] arn [info] info: FIRST-TIME RUN DETECTED: Applying special handling for first analysis {"service":"koalens-backend","timestamp":"2025-04-08T14:24:27.269Z"}

2025-04-08T14:24:27.271 app[e286e727be9368] arn [info] info: Video analysis completed by service {"ingredientCount":3,"isUncertain":false,"isVegan":true,"processingTimeSec":"4.21","requestId":"not-provided","service":"koalens-backend","timestamp":"2025-04-08T14:24:27.271Z"}

2025-04-08T14:24:27.272 app[e286e727be9368] arn [info] info: Sending analysis response to client {"confidence":0.9,"ingredientCount":3,"isUncertain":false,"isVegan":true,"nonVeganCount":0,"problemIngredient":null,"responseData":"{\"success\":true,\"result\":{\"isVegan\":true,\"isUncertain\":false,\"confidence\":0.9,\"status\":\"vegansk\",\"statusColor\":\"green\",\"ingredientList\":[\"Majs\",\"e304\",\"Soja\"],\"ingredientsWithStatus\":[{\"name\":\"Majs\",\"isVegan\":true,\"isUncertain\":false,\"status\":\"vegan\",\"statusColor\":\"green\",\"description\":\"Ingrediensen \\\"Majs\\\" är vegansk.\"},{\"name\":\"e304\",\"isVegan\":true,\"isUncertain\":false,\"status\":\"vegan\",\"statusColor\":\"green\",\"description\":\"Ingrediensen \\\"e304\\\" är vegansk.\"},{\"name\":\"Soja\",\"isVegan\":true,\"isUncertain\":false,\"status\":\"vegan\",\"statusColor\":\"green\",\"description\":\"Ingrediensen \\\"Soja\\\" är vegansk.\"}],\"watchedIngredients\":[],\"veganIngredients\":[\"Majs\",\"e304\",\"Soja\"],\"nonVeganIngredients\":[],\"uncertainIngredients\":[],\"problemIngredient\":null,\"uncertainReasons\":[],\"reasoning\":\"Alla identifierade ingredienser är veganska baserat på databas och AI-analys.\"}}","service":"koalens-backend","status":"vegansk","timestamp":"2025-04-08T14:24:27.273Z","uncertainCount":0,"veganCount":3}

2025-04-08T14:24:27.528 app[6e822504c7e598] arn [info] Ökar räknare "analysis_count" för användare: a55a792d-dd3f-49b1-85b3-6264423809c1

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] Räknare ökad: {

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] limit: 15,

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] value: 7,

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] user_id: 'a55a792d-dd3f-49b1-85b3-6264423809c1',

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] remaining: 8,

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] counter_id: 'c41ab73d-c43d-4368-b193-20e76ffb8f4e',

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] is_limited: true,

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] last_reset: '2025-04-08T11:10:07.5617+00:00',

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] next_reset: '2025-05-08T11:10:07.5617+00:00',

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] counter_name: 'analysis_count',

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] reset_frequency: 'monthly',

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] has_reached_limit: false

2025-04-08T14:24:27.616 app[6e822504c7e598] arn [info] }

2025-04-08T14:24:31.237 app[e286e727be9368] arn [info] warn: Video optimization timed out, using original video {"service":"koalens-backend","timestamp":"2025-04-08T14:24:31.237Z"}